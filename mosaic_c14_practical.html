<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joe Roe">

<title>Radiocarbon and aoristic modelling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="mosaic_c14_practical_files/libs/clipboard/clipboard.min.js"></script>
<script src="mosaic_c14_practical_files/libs/quarto-html/quarto.js"></script>
<script src="mosaic_c14_practical_files/libs/quarto-html/popper.min.js"></script>
<script src="mosaic_c14_practical_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="mosaic_c14_practical_files/libs/quarto-html/anchor.min.js"></script>
<link href="mosaic_c14_practical_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="mosaic_c14_practical_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="mosaic_c14_practical_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="mosaic_c14_practical_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="mosaic_c14_practical_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#acquiring-radiocarbon-data" id="toc-acquiring-radiocarbon-data" class="nav-link" data-scroll-target="#acquiring-radiocarbon-data"><span class="header-section-number">2</span> Acquiring radiocarbon data</a>
  <ul class="collapse">
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">2.1</span> Exercises</a></li>
  </ul></li>
  <li><a href="#cleaning-radiocarbon-data" id="toc-cleaning-radiocarbon-data" class="nav-link" data-scroll-target="#cleaning-radiocarbon-data"><span class="header-section-number">3</span> Cleaning radiocarbon data</a>
  <ul class="collapse">
  <li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1"><span class="header-section-number">3.1</span> Exercises</a></li>
  </ul></li>
  <li><a href="#radiocarbon-calibration" id="toc-radiocarbon-calibration" class="nav-link" data-scroll-target="#radiocarbon-calibration"><span class="header-section-number">4</span> Radiocarbon calibration</a>
  <ul class="collapse">
  <li><a href="#exercises-2" id="toc-exercises-2" class="nav-link" data-scroll-target="#exercises-2"><span class="header-section-number">4.1</span> Exercises</a></li>
  </ul></li>
  <li><a href="#constructing-aoristic-periods" id="toc-constructing-aoristic-periods" class="nav-link" data-scroll-target="#constructing-aoristic-periods"><span class="header-section-number">5</span> Constructing aoristic periods</a>
  <ul class="collapse">
  <li><a href="#exercises-3" id="toc-exercises-3" class="nav-link" data-scroll-target="#exercises-3"><span class="header-section-number">5.1</span> Exercises</a></li>
  </ul></li>
  <li><a href="#summarising-dates" id="toc-summarising-dates" class="nav-link" data-scroll-target="#summarising-dates"><span class="header-section-number">6</span> Summarising dates</a>
  <ul class="collapse">
  <li><a href="#exercises-4" id="toc-exercises-4" class="nav-link" data-scroll-target="#exercises-4"><span class="header-section-number">6.1</span> Exercises</a></li>
  </ul></li>
  <li><a href="#plotting-dates" id="toc-plotting-dates" class="nav-link" data-scroll-target="#plotting-dates"><span class="header-section-number">7</span> Plotting dates</a>
  <ul class="collapse">
  <li><a href="#exercises-5" id="toc-exercises-5" class="nav-link" data-scroll-target="#exercises-5"><span class="header-section-number">7.1</span> Exercises</a></li>
  </ul></li>
  <li><a href="#aggregating-dates" id="toc-aggregating-dates" class="nav-link" data-scroll-target="#aggregating-dates"><span class="header-section-number">8</span> Aggregating dates</a>
  <ul class="collapse">
  <li><a href="#exercises-6" id="toc-exercises-6" class="nav-link" data-scroll-target="#exercises-6"><span class="header-section-number">8.1</span> Exercises</a></li>
  </ul></li>
  <li><a href="#stretch-monte-carlo-simulation" id="toc-stretch-monte-carlo-simulation" class="nav-link" data-scroll-target="#stretch-monte-carlo-simulation"><span class="header-section-number">9</span> [Stretch] Monte Carlo simulation</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Radiocarbon and aoristic modelling</h1>
<p class="subtitle lead">MOSAIC Summer School, Bibracte, 2–6 September 2024</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joe Roe </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<!-- TODO:
- [ ] add bibliography
-->
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<ul>
<li>Aside: tidy data</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"maps"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"sf"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="acquiring-radiocarbon-data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Acquiring radiocarbon data</h1>
<p>Where you get your radiocarbon data will vary considerably based on your application, region and period of interest. An in-depth regional study will very likely involve at least some compilation of dates from the primary literature. However, there are a number of global ‘metadatabases’ available that provide a good starting point for many analyses. Here we will focus on two that have an R interface: <a href="https://docs.ropensci.org/c14bazAAR/">c14bazAAR</a> and <a href="https://r.xronos.ch">XRONOS</a>.</p>
<p>c14bazAAR lets you download and collate a large number (26 as of writing) of open radiocarbon compilations, mostly covering specific regions. After you have installed the package, you can download all of them at once, but this is time-consuming:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Don't run:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>c14bazAAR<span class="sc">::</span><span class="fu">get_all_dates</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Instead, let’s combine three databases that cover Western Europe: <a href="https://ees.kuleuven.be/en/geography/projects/14c-palaeolithic">Radiocarbon Palaeolithic Europe</a>, <a href="https://github.com/zoometh/neonet">NeoNet</a> (Mesolithic–Neolithic), and <a href="https://radonb.ufg.uni-kiel.de/">RADO.NB</a> (Neolithic–Iron Age):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>weurope_c14 <span class="ot">&lt;-</span> c14bazAAR<span class="sc">::</span><span class="fu">get_c14data</span>(<span class="fu">c</span>(<span class="st">"14cpalaeolithic"</span>, <span class="st">"neonet"</span>, <span class="st">"rado.nb"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Trying to download all dates from the requested databases...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                        
  |                                                  |   0%
  |                                                        
  |++++++++++++                                      |  25%</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in utils::download.file(db_url, destfile = temp, mode = "wb", quiet =
TRUE): downloaded length 581632 != reported length 2115211</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in utils::download.file(db_url, destfile = temp, mode = "wb", quiet =
TRUE): URL
'https://ees.kuleuven.be/en/geography/projects/14c-palaeolithic/download/radiocarbon-palaeolithic-europe-database-v31.xlsx':
Timeout of 60 seconds was reached</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                        
  |+++++++++++++++++++++++++                         |  50%
  |                                                        
  |+++++++++++++++++++++++++++++++++++++             |  74%
  |                                                        
  |++++++++++++++++++++++++++++++++++++++++++++++++++|  99%</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in c14bazAAR::get_c14data(c("14cpalaeolithic", "neonet", "rado.nb")): There were errors:

14cpalaeolithic --&gt; download from 'https://ees.kuleuven.be/en/geography/projects/14c-palaeolithic/download/radiocarbon-palaeolithic-europe-database-v31.xlsx' failed

Not all data might have been downloaded accurately!
In case of a timout try increasing the download time with options(timeout=300).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                        
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100%</code></pre>
</div>
</div>
<p>The advantage of using c14bazAAR (as opposed to simply downloading the individual datasets) is that it standardises the different data structures and variable names used by the different sources and gives you a single table:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    Radiocarbon date list
    dates: 37791
    sites: 8939
    countries: 75
    uncalBP: 80000 - 0 

# A data frame: 37,791 × 17
   sourcedb sourcedb_version labnr   c14age c14std c13val site  sitetype feature
   &lt;chr&gt;    &lt;date&gt;           &lt;chr&gt;    &lt;int&gt;  &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;  
 1 rado.nb  2024-09-03       Bln-32…     NA     NA   NA   Budk… &lt;NA&gt;      &lt;NA&gt;  
 2 rado.nb  2024-09-03       K-1114    1960    100   NA   Hjor… bogfind   &lt;NA&gt;  
 3 rado.nb  2024-09-03       B-2745    3490     85   NA   Padn… fortifi… "Siedl…
 4 rado.nb  2024-09-03       OxA-32…   3490     60  -21.4 Poul… &lt;NA&gt;     "34-17…
 5 rado.nb  2024-09-03       P-1895    3324     51   NA   Akro… &lt;NA&gt;      &lt;NA&gt;  
 6 rado.nb  2024-09-03       MAMS-n…   3737     22   NA   Klob… settlem… "40316"
 7 rado.nb  2024-09-03       Bln-56…   3507     37   NA   Oarţ… settlem…  &lt;NA&gt;  
 8 rado.nb  2024-09-03       K-3247    4110     85   NA   Sjør… single … "\"Fro…
 9 rado.nb  2024-09-03       Ly-2323   5860    190   NA   Menn… settlem… "FOSSE…
10 rado.nb  2024-09-03       ETH-98…   4755     60   NA   Högb… single … "skele…
# ℹ 37,781 more rows
# ℹ 8 more variables: period &lt;chr&gt;, culture &lt;chr&gt;, material &lt;chr&gt;,
#   species &lt;chr&gt;, country &lt;chr&gt;, lat &lt;dbl&gt;, lon &lt;dbl&gt;, shortref &lt;chr&gt;</code></pre>
</div>
</div>
<p>The most important columns from a chronological perspective are <code>c14age</code> (the conventional radiocarbon age, CRA) and <code>c14std</code> (the error associated with the age). In addition, we have a lot of metadata. This includes coordinate columns (<code>lat</code> and <code>lon</code>), which we can use to inspect the geographic coverage of our dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>weurope_c14 <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(lon, lat) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>)) <span class="sc">|&gt;</span> <span class="co"># EPSG:4326 = WGS84 lat/long</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sf</span>(<span class="fu">map</span>(<span class="st">"world"</span>, <span class="at">plot =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>)), </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mosaic_c14_practical_files/figure-html/weurope-c14-map-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Similarly, we can use plot the distribution of the radiocarbon ages to quickly visualise the chronological coverage (remember the scale here is <em>uncalibrated</em> years BP):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weurope_c14, <span class="fu">aes</span>(c14age)) <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">300</span>) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"uncal BP"</span>, </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_comma</span>(),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">100000</span>, <span class="dv">1000</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">transform =</span> <span class="fu">c</span>(<span class="st">"log10"</span>, <span class="st">"reverse"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in scale_x_continuous(name = "uncal BP", labels =
scales::label_comma(), : composition(log-10,reverse) transformation introduced
infinite values.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 200 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mosaic_c14_practical_files/figure-html/weurope-c14-dist-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>c14bazAAR</li>
<li>XRONOS &amp; xronos.R</li>
<li>Aside: other sources of radiocarbon data (esp.&nbsp;regional)</li>
</ul>
<section id="exercises" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="exercises"><span class="header-section-number">2.1</span> Exercises</h2>
<ol type="1">
<li>How many of the dates in our <code>weurope_c14</code> dataset are missing a) a lab number b) a radiocarbon age c) a radiocarbon error and d) coordinates?</li>
</ol>
</section>
</section>
<section id="cleaning-radiocarbon-data" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Cleaning radiocarbon data</h1>
<ul>
<li>BP/BCE -&gt; era</li>
<li>Aside: chronometric hygiene and importance of metadata</li>
</ul>
<section id="exercises-1" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="exercises-1"><span class="header-section-number">3.1</span> Exercises</h2>
</section>
</section>
<section id="radiocarbon-calibration" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Radiocarbon calibration</h1>
<ul>
<li>Aside: tidy modelling / nested data frames</li>
</ul>
<section id="exercises-2" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="exercises-2"><span class="header-section-number">4.1</span> Exercises</h2>
</section>
</section>
<section id="constructing-aoristic-periods" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Constructing aoristic periods</h1>
<ul>
<li>With a uniform distribution</li>
<li>With a trapezoidal distribution (a la OxCal) ?</li>
<li>‘Calendar probability distributions’</li>
</ul>
<section id="exercises-3" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="exercises-3"><span class="header-section-number">5.1</span> Exercises</h2>
</section>
</section>
<section id="summarising-dates" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Summarising dates</h1>
<ul>
<li>Mid-point estimates
<ul>
<li>Aside: caveat empor</li>
</ul></li>
<li>Ranges</li>
<li>Summarise by other variables</li>
</ul>
<section id="exercises-4" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="exercises-4"><span class="header-section-number">6.1</span> Exercises</h2>
</section>
</section>
<section id="plotting-dates" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Plotting dates</h1>
<ul>
<li>Plotting the probability distribution</li>
<li>Plotting summaries
<ul>
<li>Bernie’s plot</li>
</ul></li>
</ul>
<section id="exercises-5" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="exercises-5"><span class="header-section-number">7.1</span> Exercises</h2>
</section>
</section>
<section id="aggregating-dates" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Aggregating dates</h1>
<ul>
<li>SPD</li>
<li>(c)KDE</li>
<li>Aside: extensive literature on aggregation</li>
<li>Aggregate by other variables</li>
</ul>
<section id="exercises-6" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="exercises-6"><span class="header-section-number">8.1</span> Exercises</h2>
</section>
</section>
<section id="stretch-monte-carlo-simulation" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> [Stretch] Monte Carlo simulation</h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>